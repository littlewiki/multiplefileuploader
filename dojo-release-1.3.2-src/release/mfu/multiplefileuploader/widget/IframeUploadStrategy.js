/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["multiplefileuploader.widget.IframeUploadStrategy"]){dojo._hasResource["multiplefileuploader.widget.IframeUploadStrategy"]=true;dojo.provide("multiplefileuploader.widget.IframeUploadStrategy");dojo.require("dojo.io.iframe");dojo.declare("multiplefileuploader.widget.IframeUploadStrategy",null,{constructor:function(_1,_2){this._config_server=_1;this._config_status=_2;this._temporaryUploadForm=null;this._createTemporaryForm();},upload:function(_3,_4){this._prepareForm(_4);console.debug(this._temporaryUploadForm);console.debug("we r going to upload");dojo.io.iframe.send({url:this._config_server.ajaxUploadUrl,method:"POST",timeout:this._config_server.uploadTimeout,handleAs:"text",form:this._temporaryUploadForm,load:dojo.hitch(this,function(_5){dojox.data.dom.removeChildren(this._temporaryUploadForm);_3.onSuccess(_5,this._config_server.uploadValuePrefix);}),error:dojo.hitch(this,function(_6){console.debug("upload on error");dojox.data.dom.removeChildren(this._temporaryUploadForm);_3.onError(_6);})});},_prepareForm:function(_7){if(this._config_server.apc_php_enabled){this._createAPCInput(_7);}this._createFileInput(_7);this._createStatusIDInput(_7);},_createFileInput:function(_8){console.debug("create file ");var _9=_8.getFileInput();dojo.attr(_9,"name",this._config_server.uploadParameterName);dojo.place(_9,this._temporaryUploadForm);},_createStatusIDInput:function(_a){var _b=document.createElement("input");dojo.attr(_b,"type","hidden");dojo.attr(_b,"name",this._config_status.statusParameterName);dojo.attr(_b,"value",_a.getAssociatedID());dojo.place(_b,this._temporaryUploadForm);},_createAPCInput:function(_c){var _d=document.createElement("input");dojo.attr(_d,"type","hidden");dojo.attr(_d,"name","APC_UPLOAD_PROGRESS");dojo.attr(_d,"value",_c.getAssociatedID());dojo.place(_d,this._temporaryUploadForm);},_createTemporaryForm:function(){if(dojo.isIE){this._temporaryUploadForm=document.createElement("<form style=\"display:none\" enctype=\"multipart/form-data\" method=\"post\">");this._temporaryUploadForm.encoding="multipart/form-data";}else{this._temporaryUploadForm=document.createElement("form");dojo.style(this._temporaryUploadForm,{display:"none"});this._temporaryUploadForm.setAttribute("enctype","multipart/form-data");}dojo.body().appendChild(this._temporaryUploadForm);}});}